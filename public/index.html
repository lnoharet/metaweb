<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="basic_style.css">
    <title>METAweb</title>
</head>

<body>
    <div>Welcome to METAweb!</div>
    <div id="root"></div>

    <div class="stat_select_dropdown" id = "stat_select_btn">
      <select onChange=selectChange(this.value)>
        <option value="0">Select stat:</option>
        <option value="1">Mob Kills</option>
        <option value="2">Player Kills</option>
        <option value="3">Deaths</option>
        <option value="4">Total time played</option>
        <option value="5">Amount of sessions played</option>
        <option value="6">Session length</option>
      </select>
    </div>


    <div className="sidebar-comp">
      <h2 className="h2-sidebar">METAcraft server</h2>
      <div className="hr-sidebar"></div>

      <div className="head-group">
          <!--<img className="img-head" src={playerhead}></img>-->
          <h2 className="h2-players">Players</h2>
      </div>
    <div className="player-list-container" id = "player-list">
  </div>

  <div className="hr-sidebar"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
      var socket = io();
      socket.emit('get_users');

      var current_user;
      var current_stat;

      // Create User buttons
      /* 
      1. Get user names into an array
      2. Create buttons with the value same as username
      3. AddEventListener on "click" to set as a global variable the buttons value/username
      */
      var users; // list of all users
      // TODO: Add info about if the user is online or not and last seen online.
      socket.on('get_users_response', function (arg) {
          alert('get_users_response');
          users = arg;
          
          for(let i = 0; i<users.length;i++){
            var user_button = document.createElement("button");
            // Lägg till en classname på varje button
            user_button.innerHTML = users[i].name;
            user_button.id = users[i].uuid;
            user_button.value = users[i].name;
            var div = document.getElementById("player-list");
            div.appendChild(user_button);
            user_button.addEventListener ("click", function() {
                window.current_user = this.id; 
                alert("set current user to ".concat(window.current_user));
            });
          }
      });

      /*------------------------------------------------------------------------------------------------*/
      // Socket communication
      /*var buttons = document.getElementsByClassName("player");

      for (var i = 0; i < buttons.length; i++) {
        var button = buttons[i];
        button.addEventListener("click", function (event) {
          var elem = event.target;
          var data = { id: elem.id };
          // Emit event with data
          socket.emit('clicked', data);
          alert('booton');
          console.log("Emitting clicked data", data);
          });
      } */

      socket.on('response', function (arg) {
          var res = "Survival time ";
          alert('response');
          document.write(res.concat(arg));
      });

      /*------------------------------------------------------------------------------------------------*/
      // Stat selection
      // Get Stat selection and query based on choice.
      function selectChange(stat_selection){
        window.current_stat = stat_selection;
        alert(window.current_stat);
        if (stat_selection != 0){
            socket.emit("get_stat",  {user : window.current_user, stat: window.current_stat});
        }
      }
  </script>
    
<!---- <script src="./sidebar.js"></script> -->

</body>

</html>