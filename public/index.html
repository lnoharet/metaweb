<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;300&display=swap" rel="stylesheet">
    <title>METAweb</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>

<body style="margin:0">
    <div id="root"></div>
    <div class="container">
        <ul>
            <div class="sidebar-comp">
                <h2 class="h2-sidebar">METAcraft server</h2>
                <div class="hr-sidebar"></div>

                <div class="head-group">
                    <img class="img-head" src="head.png"></img>
                    <h2 class="h2-players">Players</h2>
                </div>

                <div class="player-list-container" id="player-list">
                    <!--player divs will be added here-->
                </div>

                <div class="hr-sidebar"></div>

                <div class="sidebar-chart">
                    <div class="stat_select_dropdown" id="stat_select_btn">
                        <select onChange=selectChange(this.value) value="0">
                            <option value="0" hidden>Select stat:</option>
                            <option value="1">Mob Kills</option>
                            <option value="2">Player Kills</option>
                            <option value="3">Deaths</option>
                            <option value="4">Total time played</option>
                            <option value="5">Amount of sessions played</option>
                            <option value="6">Session length</option>
                        </select>
                    </div>
                </div>
                <div>
                    <div id="d3-container"></div>
                </div>
            </div>

        </ul>
    </div>
    <script src="chart.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        socket.emit('get_users');

        var current_user;
        var current_stat;

        // Create User buttons
        /* 
        1. Get user names into an array
        2. Create buttons with the value same as username
        3. AddEventListener on "click" to set as a global variable the buttons value/username
        */
        var users; // list of all users
        // TODO: Add info about if the user is online or not and last seen online.
        socket.on('get_users_response', function (arg) {
            console.log('get_users_response');
            users = arg;

            for (let i = 0; i < users.length; i++) {
                var playerContainer = document.createElement("li");
                var playerName = document.createElement("div")
                playerContainer.className = "player-container";
                playerContainer.id = users[i].uuid;
                playerContainer.value = users[i].name;
                playerName.innerHTML = users[i].name;
                playerName.className = "player-name";
                var parentDiv = document.getElementById("player-list");
                parentDiv.appendChild(playerContainer);
                playerContainer.appendChild(playerName);
                playerContainer.addEventListener("click", function () {
                    window.current_user = this.id;
                    console.log("set current user to ".concat(window.current_user));
                });
            }
        });

        /*------------------------------------------------------------------------------------------------*/
        // Socket communication
        /*var buttons = document.getElementsByClassName("player");
  
        for (var i = 0; i < buttons.length; i++) {
          var button = buttons[i];
          button.addEventListener("click", function (event) {
            var elem = event.target;
            var data = { id: elem.id };
            // Emit event with data
            socket.emit('clicked', data);
            alert('booton');
            console.log("Emitting clicked data", data);
            });
        } */

        socket.on('response', function (arg) {
            var res = "Survival time ";
            console.log('response');
            document.write(res.concat(arg));
        });

        /*------------------------------------------------------------------------------------------------*/
        // Stat selection
        // Get Stat selection and query based on choice.
        function selectChange(stat_selection) {
            window.current_stat = stat_selection;
            console.log(window.current_stat);
            if (stat_selection != 0) {
                socket.emit("get_stat", { user: window.current_user, stat: window.current_stat });
            }
        }
    </script>

</body>

</html>